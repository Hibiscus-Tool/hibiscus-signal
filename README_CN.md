<div align="center">

# ğŸŒº Hibiscus Signal

[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![Maven Central](https://img.shields.io/maven-central/v/io.github.heathcetide/cetide.hibiscus.signal)](https://mvnrepository.com/artifact/io.github.heathcetide/cetide.hibiscus.signal)
[![Java Version](https://img.shields.io/badge/java-1.8%2B-orange.svg)](https://www.oracle.com/java/)
[![GitHub Stars](https://img.shields.io/github/stars/Hibiscus-Tool/hibiscus-signal.svg?style=social&label=Star)](https://github.com/Hibiscus-Tool/hibiscus-signal)
[![GitHub Forks](https://img.shields.io/github/forks/Hibiscus-Tool/hibiscus-signal.svg?style=social&label=Fork)](https://github.com/Hibiscus-Tool/hibiscus-signal/fork)

[English (README.md)](README.md) | **ä¸­æ–‡**

**ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€ç‰¹æ€§ä¸°å¯Œçš„äº‹ä»¶é©±åŠ¨æ¡†æ¶ï¼Œä¸“ä¸º Java åº”ç”¨ç¨‹åºè®¾è®¡**

[ç‰¹æ€§](#ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [æ–‡æ¡£](#ä½¿ç”¨ç¤ºä¾‹) â€¢ [è´¡çŒ®](#è´¡çŒ®)

</div>

---

## æ¦‚è¿°

**Hibiscus Signal** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€ç‰¹æ€§ä¸°å¯Œçš„äº‹ä»¶é©±åŠ¨æ¡†æ¶ï¼Œä¸“ä¸º Java åº”ç”¨ç¨‹åºè®¾è®¡ã€‚å®ƒæä¾›äº†çµæ´»ä¸”å¯æ‰©å±•çš„æ–¹å¼æ¥ç®¡ç†ä¿¡å·ã€äº‹ä»¶å’Œå¤„ç†ç¨‹åºï¼Œå…·æœ‰æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨ã€è½¬æ¢å™¨ã€ç†”æ–­å™¨ã€é™æµã€äº‹ä»¶æº¯æºå’Œäº‹åŠ¡æ”¯æŒç­‰é«˜çº§åŠŸèƒ½ã€‚

### âœ¨ ä¸ºä»€ä¹ˆé€‰æ‹© Hibiscus Signalï¼Ÿ

- ğŸš€ **é«˜æ€§èƒ½**ï¼šä¸“ä¸ºé«˜ååé‡äº‹ä»¶å¤„ç†è€Œæ„å»º
- ğŸ”’ **ä¼ä¸šçº§**ï¼šäº‹åŠ¡æ”¯æŒã€æ­»ä¿¡é˜Ÿåˆ—å’Œå…¨é¢çš„é”™è¯¯å¤„ç†
- ğŸ“ˆ **å¯è§‚æµ‹æ€§**ï¼šå†…ç½®æŒ‡æ ‡ã€è¿½è¸ªå’Œç›‘æ§èƒ½åŠ›
- ğŸ›¡ï¸ **å¼¹æ€§**ï¼šç†”æ–­å™¨å’Œé™æµå™¨ä¿æŠ¤æ‚¨çš„ç³»ç»Ÿ
- ğŸ”„ **äº‹ä»¶æº¯æº**ï¼šå®Œæ•´æ”¯æŒäº‹ä»¶æº¯æºæ¨¡å¼
- ğŸŒ± **Spring Boot åŸç”Ÿ**ï¼šä¸ Spring Boot ç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆ
- ğŸ’¾ **å¤šç§æŒä¹…åŒ–**ï¼šæ”¯æŒæ–‡ä»¶ã€Redisã€æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—
- ğŸ¯ **ç±»å‹å®‰å…¨**ï¼šæ³›å‹ç±»å‹æ”¯æŒï¼Œç¼–è¯‘æ—¶å®‰å…¨

---

## ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½

- **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šæ”¯æŒå¼‚æ­¥å’ŒåŒæ­¥ä¿¡å·å¤„ç†
- **Spring Boot é›†æˆ**ï¼šé›¶é…ç½®è‡ªåŠ¨é…ç½®ï¼Œä¸ Spring Boot å®Œç¾é›†æˆ
- **çµæ´»çš„å¤„ç†å™¨æ³¨å†Œ**ï¼šå¤šç§æ–¹å¼æ³¨å†Œå¤„ç†å™¨ï¼ˆæ³¨è§£ã€ç¼–ç¨‹å¼ï¼‰
- **åŸºäºä¼˜å…ˆçº§çš„å¤„ç†**ï¼šæ”¯æŒ HIGHã€MEDIUM å’Œ LOW ä¸‰ä¸ªä¼˜å…ˆçº§çº§åˆ«
- **ç®¡é“å¤„ç†**ï¼šæ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨å’Œè½¬æ¢å™¨ç”¨äºä¿¡å·å¤„ç†

### ğŸ›¡ï¸ ä¿æŠ¤æœºåˆ¶

- **ç†”æ–­å™¨**ï¼šè‡ªåŠ¨ç†”æ–­å™¨ï¼Œæ”¯æŒ CLOSED/OPEN/HALF_OPEN çŠ¶æ€
- **é™æµå™¨**ï¼šæ»‘åŠ¨çª—å£é™æµå™¨ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½
- **å¯é…ç½®é˜ˆå€¼**ï¼šå¯è‡ªå®šä¹‰å¤±è´¥é˜ˆå€¼å’Œé”™è¯¯ç‡

### ğŸ’¾ æŒä¹…åŒ–é€‰é¡¹

- **æ–‡ä»¶æŒä¹…åŒ–**ï¼šåŸºäºæ–‡ä»¶çš„å¢é‡å­˜å‚¨
- **Redis æŒä¹…åŒ–**ï¼šé«˜æ€§èƒ½ Redis å­˜å‚¨ï¼Œæ”¯æŒ TTL
- **æ•°æ®åº“æŒä¹…åŒ–**ï¼šåŸºäº JPA çš„æ•°æ®åº“å­˜å‚¨ï¼Œæ”¯æŒè‡ªåŠ¨æ¸…ç†
- **æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–**ï¼šæ”¯æŒ RabbitMQ å’Œ Kafka

### ğŸ“Š ç›‘æ§ä¸è¿½è¸ª

- **æŒ‡æ ‡æ”¶é›†**ï¼šè·Ÿè¸ªå‘å°„æ¬¡æ•°ã€å¤„ç†æ—¶é—´ã€é”™è¯¯ç‡
- **è¯·æ±‚è¿½è¸ª**ï¼šå†…ç½®åŸºäº Span çš„è¿½è¸ªç³»ç»Ÿ
- **ä¸Šä¸‹æ–‡ä¼ æ’­**ï¼šä½¿ç”¨ Transmittable Thread Local è¿›è¡Œçº¿ç¨‹æœ¬åœ°ä¸Šä¸‹æ–‡ä¼ æ’­

### ğŸ”„ äº‹ä»¶æº¯æº

- **èšåˆæ ¹æ”¯æŒ**ï¼šå®Œæ•´çš„äº‹ä»¶æº¯æºæ¨¡å¼å®ç°
- **äº‹ä»¶å­˜å‚¨**ï¼šåŸºäºæ•°æ®åº“çš„äº‹ä»¶å­˜å‚¨
- **äº‹ä»¶é‡æ”¾**ï¼šä»äº‹ä»¶å†å²é‡å»ºèšåˆ
- **äº‹ä»¶ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒä¹è§‚é”çš„ç‰ˆæœ¬æ§åˆ¶

### ğŸ” äº‹åŠ¡æ”¯æŒ

- **éš”ç¦»äº‹åŠ¡**ï¼šæ¯ä¸ªäº‹ä»¶åœ¨ç‹¬ç«‹äº‹åŠ¡ä¸­å¤„ç†
- **é‡è¯•æœºåˆ¶**ï¼šæŒ‡æ•°é€€é¿å’ŒæŠ–åŠ¨ç­–ç•¥å¤„ç†å¤±è´¥äº‹ä»¶
- **æ­»ä¿¡é˜Ÿåˆ—**ï¼šé‡è¯•å¤±è´¥åè‡ªåŠ¨å¤„ç†æ­»ä¿¡äº‹ä»¶
- **äº‹åŠ¡ç®¡ç†**ï¼šä¸ Spring äº‹åŠ¡ç®¡ç†å™¨é›†æˆ

---

## å¿«é€Ÿå¼€å§‹

### Maven ä¾èµ–

```xml
<dependency>
    <groupId>io.github.heathcetide</groupId>
    <artifactId>cetide.hibiscus.signal</artifactId>
    <version>1.1.0</version>
</dependency>
```

### Gradle ä¾èµ–

```gradle
implementation 'io.github.heathcetide:cetide.hibiscus.signal:1.1.0'
```

### åŸºæœ¬é…ç½®

åœ¨ `application.yml` ä¸­æ·»åŠ ï¼š

```yaml
hibiscus:
  persistent: true
  persistence-methods:
    - file
    - redis
    - db
  redis-enabled: true
  redis-host: localhost
  redis-port: 6379
  database-persistent: true
  database-table-name: signal_events
  protection-enabled: true
  circuit-breaker-failure-threshold: 5
  rate-limiter-max-requests-per-second: 1000
  transaction-enabled: true
```

---

## ä½¿ç”¨ç¤ºä¾‹

### 1. ä½¿ç”¨æ³¨è§£æ–¹å¼ï¼ˆæ¨èï¼‰

#### å‘å°„ä¿¡å·

```java
import io.github.signal.spring.anno.SignalEmitter;
import org.springframework.stereotype.Service;

@Service
public class OrderService {
    
    @SignalEmitter("order.created")
    public Order createOrder(String userId, String productId) {
        Order order = new Order(userId, productId);
        // ... ä¿å­˜è®¢å•é€»è¾‘
        return order; // è¿™å°†è§¦å‘ä¿¡å·å‘å°„
    }
}
```

#### å¤„ç†ä¿¡å·

```java
import io.github.signal.spring.anno.SignalHandler;
import io.github.signal.core.model.SignalContext;
import io.github.signal.core.enums.SignalPriority;
import org.springframework.stereotype.Service;

@Service
public class NotificationService {
    
    @SignalHandler(
        value = "order.created",
        target = NotificationService.class,
        methodName = "sendOrderConfirmation",
        async = true,
        maxRetries = 3,
        timeoutMs = 5000,
        priority = SignalPriority.HIGH
    )
    public void sendOrderConfirmation(SignalContext context) {
        String userId = (String) context.getAttribute("userId");
        String orderId = (String) context.getAttribute("result");
        
        // å‘é€é€šçŸ¥é‚®ä»¶
        emailService.sendConfirmationEmail(userId, orderId);
    }
}
```

### 2. ç¼–ç¨‹å¼ä½¿ç”¨

```java
import io.github.signal.core.Signals;
import io.github.signal.core.SignalHandler;
import io.github.signal.core.config.SignalConfig;
import io.github.signal.core.model.Envelope;
import io.github.signal.core.model.SignalContext;
import io.github.signal.core.enums.SignalPriority;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Component
public class OrderProcessor {
    
    @Autowired
    private Signals<Object, Object> signals;
    
    public void initialize() {
        // æ³¨å†Œå¤„ç†å™¨
        SignalConfig config = SignalConfig.builder()
            .async(true)
            .maxRetries(3)
            .timeoutMs(5000)
            .priority(SignalPriority.HIGH)
            .recordMetrics(true)
            .build();
            
        signals.connect("order.created", 
            (Envelope<Object, Object> envelope) -> {
                SignalContext context = envelope.getContext();
                String orderId = (String) context.getAttribute("orderId");
                processOrder(orderId);
            }, 
            config
        );
    }
    
    public void emitOrderCreated(Order order) {
        SignalContext context = new SignalContext();
        context.initTrace("order.created");
        context.setAttribute("orderId", order.getId());
        context.setAttribute("userId", order.getUserId());
        
        signals.emit("order.created",
            Envelope.Builder.builder()
                .payload(order)
                .context(context)
                .sender(this)
                .build(),
            (Throwable error) -> {
                // é”™è¯¯å¤„ç†
                log.error("ä¿¡å·å‘å°„å¤±è´¥", error);
            }
        );
    }
}
```

### 3. è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨å’Œè½¬æ¢å™¨

#### è¿‡æ»¤å™¨ç¤ºä¾‹

```java
import io.github.signal.core.SignalFilter;
import io.github.signal.core.model.Envelope;
import org.springframework.stereotype.Component;

@Component
public class OrderValidationFilter implements SignalFilter<Object, Object> {
    
    @Override
    public boolean filter(String event, Envelope<Object, Object> envelope) {
        SignalContext context = envelope.getContext();
        String userId = (String) context.getAttribute("userId");
        
        // åªå¤„ç†æ´»è·ƒç”¨æˆ·çš„è®¢å•
        return userService.isUserActive(userId);
    }
    
    @Override
    public int getPriority() {
        return 100; // æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    }
}

// æ³¨å†Œè¿‡æ»¤å™¨
signals.addFilter("order.created", orderValidationFilter);
```

#### æ‹¦æˆªå™¨ç¤ºä¾‹

```java
import io.github.signal.core.SignalInterceptor;
import io.github.signal.core.model.Envelope;
import org.springframework.stereotype.Component;

@Component
public class LoggingInterceptor implements SignalInterceptor<Object, Object> {
    
    @Override
    public boolean beforeHandle(String event, Envelope<Object, Object> envelope) {
        log.info("æ­£åœ¨å¤„ç†ä¿¡å·: {}", event);
        return true; // ç»§ç»­å¤„ç†
    }
    
    @Override
    public void afterHandle(String event, Envelope<Object, Object> envelope, Throwable error) {
        if (error != null) {
            log.error("ä¿¡å·å¤„ç†å¤±è´¥: {}", event, error);
        } else {
            log.info("ä¿¡å·å¤„ç†æˆåŠŸ: {}", event);
        }
    }
}

// æ³¨å†Œæ‹¦æˆªå™¨
signals.addSignalInterceptor("order.created", loggingInterceptor);
```

#### è½¬æ¢å™¨ç¤ºä¾‹

```java
import io.github.signal.core.SignalTransformer;
import io.github.signal.core.model.Envelope;
import org.springframework.stereotype.Component;

@Component
public class OrderEnrichmentTransformer implements SignalTransformer<Object, Object> {
    
    @Override
    public Envelope<Object, Object> transform(String event, Envelope<Object, Object> envelope) {
        SignalContext context = envelope.getContext();
        
        // ä¸°å¯Œä¸Šä¸‹æ–‡æ•°æ®
        String orderId = (String) context.getAttribute("orderId");
        OrderDetails details = orderService.getOrderDetails(orderId);
        context.setAttribute("orderDetails", details);
        
        return envelope;
    }
}

// æ³¨å†Œè½¬æ¢å™¨
signals.addSignalTransformer("order.created", orderEnrichmentTransformer);
```

### 4. äº‹ä»¶æº¯æºç¤ºä¾‹

```java
import io.github.signal.core.eventsourcing.AggregateRoot;
import io.github.signal.core.eventsourcing.Event;
import io.github.signal.core.eventsourcing.EventSourcingManager;
import org.springframework.beans.factory.annotation.Autowired;
import java.math.BigDecimal;
import java.util.List;

public class OrderAggregate extends AggregateRoot {
    
    private String orderId;
    private String status;
    private BigDecimal total;
    
    @Autowired
    private EventSourcingManager eventSourcingManager;
    
    public OrderAggregate(String id) {
        super(id, 0);
    }
    
    public void createOrder(String userId, List<OrderItem> items) {
        OrderCreatedEvent event = new OrderCreatedEvent(userId, items);
        applyAndRecord(event);
    }
    
    public void updateStatus(String newStatus) {
        OrderStatusUpdatedEvent event = new OrderStatusUpdatedEvent(newStatus);
        applyAndRecord(event);
    }
    
    @Override
    protected void apply(Event event) {
        if (event instanceof OrderCreatedEvent) {
            OrderCreatedEvent e = (OrderCreatedEvent) event;
            this.orderId = e.getOrderId();
            this.status = "CREATED";
            this.total = e.getTotal();
        } else if (event instanceof OrderStatusUpdatedEvent) {
            OrderStatusUpdatedEvent e = (OrderStatusUpdatedEvent) event;
            this.status = e.getNewStatus();
        }
    }
    
    public void save() {
        eventSourcingManager.save(this).join();
    }
}
```

### 5. äº‹åŠ¡æ”¯æŒ

```java
import io.github.signal.core.config.SignalConfig;
import io.github.signal.core.config.TransactionConfig;
import org.springframework.transaction.TransactionDefinition;

// é…ç½®å¯ç”¨äº‹åŠ¡çš„ä¿¡å·
TransactionConfig transactionConfig = TransactionConfig.builder()
    .enableTransaction(true)
    .enableRetry(true)
    .maxRetries(3)
    .retryDelayMs(1000)
    .enableExponentialBackoff(true)
    .enableJitter(true)
    .isolationLevel(TransactionDefinition.ISOLATION_READ_COMMITTED)
    .propagationBehavior(TransactionDefinition.PROPAGATION_REQUIRES_NEW)
    .build();

SignalConfig signalConfig = SignalConfig.builder()
    .async(true)
    .transactionConfig(transactionConfig)
    .build();

signals.connect("order.processed", handler, signalConfig);
```

---

## é…ç½®å‚è€ƒ

### åº”ç”¨é…ç½®å±æ€§

```yaml
hibiscus:
  # æŒä¹…åŒ–é…ç½®
  persistent: true                          # å¯ç”¨æŒä¹…åŒ–
  persistence-methods:                      # æ–¹æ³•: file, redis, db, mq
    - file
    - redis
    - db
  persistence-file: "signal.json"           # æ–‡ä»¶æŒä¹…åŒ–è·¯å¾„
  
  # Redis é…ç½®
  redis-enabled: true
  redis-host: localhost
  redis-port: 6379
  redis-password: ""
  redis-database: 0
  redis-expire-seconds: 86400             # TTLï¼ˆç§’ï¼‰
  
  # æ•°æ®åº“é…ç½®
  database-persistent: true
  database-table-name: signal_events
  database-retention-days: 7
  enable-database-cleanup: true
  
  # æ¶ˆæ¯é˜Ÿåˆ—é…ç½®
  mq-enabled: true
  mq-type: rabbitmq                        # rabbitmq, kafka
  mq-host: localhost
  mq-port: 5672
  mq-username: guest
  mq-password: guest
  mq-virtual-host: /
  
  # ä¿æŠ¤æœºåˆ¶é…ç½®
  protection-enabled: true
  circuit-breaker-failure-threshold: 5
  circuit-breaker-open-timeout-ms: 60000
  circuit-breaker-half-open-trial-count: 3
  circuit-breaker-error-rate-threshold: 0.5
  rate-limiter-max-requests-per-second: 1000
  
  # äº‹åŠ¡é…ç½®
  transaction-enabled: true
  transaction:
    enable-retry: true
    max-retries: 3
    retry-delay-ms: 1000
    max-retry-delay-ms: 60000
    enable-exponential-backoff: true
    enable-jitter: true
    isolation-level: 2                     # READ_COMMITTED
    propagation-behavior: 3                # REQUIRES_NEW
  
  # æ­»ä¿¡é˜Ÿåˆ—é…ç½®
  dead-letter:
    max-events: 10000
    retention-days: 30
    enable-auto-cleanup: true
```

---

## API å‚è€ƒ

### æ ¸å¿ƒç±»

#### Signals

ä¿¡å·ç®¡ç†çš„ä¸»è¦å…¥å£ç‚¹ã€‚

```java
// æ³¨å†Œå¤„ç†å™¨
long handlerId = signals.connect(String event, SignalHandler<S, T> handler);
long handlerId = signals.connect(String event, SignalHandler<S, T> handler, SignalConfig config);

// å‘å°„ä¿¡å·
signals.emit(String event, Envelope<S, T> envelope, Consumer<Throwable> errorHandler);
signals.emit(String event, Envelope<S, T> envelope, SignalCallback<S, T> callback, Consumer<Throwable> errorHandler);

// æ³¨é”€å¤„ç†å™¨
signals.disconnect(String event, long handlerId);

// è·å–æŒ‡æ ‡
SignalMetrics metrics = signals.getMetrics();
```

#### SignalConfig

ä¿¡å·å¤„ç†é…ç½®ã€‚

```java
SignalConfig config = SignalConfig.builder()
    .async(true)                           // å¼‚æ­¥æ‰§è¡Œ
    .maxRetries(3)                         // æœ€å¤§é‡è¯•æ¬¡æ•°
    .retryDelayMs(1000)                    // é‡è¯•å»¶è¿Ÿ
    .timeoutMs(5000)                       // è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    .maxHandlers(10)                       // æœ€å¤§å¹¶å‘å¤„ç†å™¨æ•°
    .priority(SignalPriority.HIGH)         // ä¼˜å…ˆçº§çº§åˆ«
    .recordMetrics(true)                   // å¯ç”¨æŒ‡æ ‡
    .transactionConfig(transactionConfig)   // äº‹åŠ¡é…ç½®
    .build();
```

#### SignalContext

ä¿¡å·å¤„ç†ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

```java
SignalContext context = new SignalContext();
context.initTrace("event.name");
context.setAttribute("key", value);
Object value = context.getAttribute("key");
List<SignalContext.Span> spans = context.getSpans();
```

---

## æ¶æ„

### ç»„ä»¶å›¾

```mermaid
graph TB
    Signals[Signals<br/>ä¸»ç®¡ç†å™¨]
    
    Signals --> Registry[SignalRegistry<br/>å¤„ç†å™¨ç®¡ç†]
    Signals --> Pipeline[SignalPipeline<br/>å¤„ç†é“¾]
    Signals --> Emitter[SignalEmitter<br/>ä¿¡å·åˆ†å‘]
    
    Registry --> Handler[SignalHandler<br/>äº‹ä»¶å¤„ç†å™¨]
    Pipeline --> Interceptor[SignalInterceptor<br/>å‰åå¤„ç†]
    Pipeline --> Filter[SignalFilter<br/>éªŒè¯]
    Pipeline --> Transformer[SignalTransformer<br/>æ•°æ®è½¬æ¢]
    Emitter --> Processor[SignalProcessor<br/>æ‰§è¡Œå¼•æ“]
    
    Processor --> Retry[é‡è¯•é€»è¾‘]
    Processor --> Timeout[è¶…æ—¶å¤„ç†]
    Processor --> Tracing[è¿½è¸ªç³»ç»Ÿ]
    
    Signals --> Protection[SignalProtectionManager<br/>ç†”æ–­å™¨ & é™æµå™¨]
    Signals --> Metrics[SignalMetrics<br/>ç›‘æ§]
    Signals --> Persistence[UnifiedSignalPersistence<br/>å­˜å‚¨å±‚]
    
    Persistence --> FilePersistence[æ–‡ä»¶æŒä¹…åŒ–]
    Persistence --> RedisPersistence[RedisæŒä¹…åŒ–]
    Persistence --> DBPersistence[æ•°æ®åº“æŒä¹…åŒ–]
    Persistence --> MQPersistence[æ¶ˆæ¯é˜Ÿåˆ—]
    
    Signals --> Transaction[EventTransactionManager<br/>äº‹åŠ¡æ”¯æŒ]
    Transaction --> DLQ[DeadLetterQueueManager<br/>å¤±è´¥äº‹ä»¶å¤„ç†]
    
    Signals --> EventSourcing[EventSourcingManager<br/>äº‹ä»¶æº¯æº]
    EventSourcing --> EventStore[EventStore<br/>äº‹ä»¶å­˜å‚¨]
    EventSourcing --> Aggregate[AggregateRoot<br/>é¢†åŸŸæ¨¡å‹]
    
    style Signals fill:#e1f5ff
    style Registry fill:#fff4e1
    style Pipeline fill:#fff4e1
    style Emitter fill:#fff4e1
    style Protection fill:#ffe1f5
    style Metrics fill:#e1ffe1
    style Persistence fill:#f5e1ff
```

### ä¿¡å·å¤„ç†æµç¨‹

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Signals as Signalsç®¡ç†å™¨
    participant Protection as ä¿æŠ¤ç®¡ç†å™¨
    participant Pipeline as ä¿¡å·ç®¡é“
    participant Handler as ä¿¡å·å¤„ç†å™¨
    participant Processor as ä¿¡å·å¤„ç†å¼•æ“
    participant Metrics as æŒ‡æ ‡
    participant Persistence as æŒä¹…åŒ–
    
    Client->>Signals: emit(event, envelope)
    Signals->>Protection: checkCircuitBreaker()
    Protection-->>Signals: allow/block
    
    alt å…è®¸
        Signals->>Pipeline: processPipeline()
        Pipeline->>Pipeline: executeInterceptors()
        Pipeline->>Pipeline: executeFilters()
        Pipeline->>Pipeline: executeTransformers()
        Pipeline-->>Signals: processedEnvelope
        
        Signals->>Handler: getHandlers()
        Handler-->>Signals: handlers[]
        
        loop æ¯ä¸ªå¤„ç†å™¨
            Signals->>Processor: executeHandler()
            Processor->>Processor: executeWithRetry()
            Processor->>Processor: executeWithTimeout()
            Processor->>Processor: executeWithTracing()
            Processor-->>Signals: success/error
        end
        
        Signals->>Metrics: recordMetrics()
        Signals->>Persistence: saveEvent()
        Persistence-->>Signals: saved
        
        Signals-->>Client: complete
    else é˜»æ­¢
        Signals-->>Client: blocked
    end
```

### äº‹ä»¶æº¯æºæµç¨‹

```mermaid
graph LR
    A[èšåˆæ ¹] -->|applyAndRecord| B[æœªæäº¤äº‹ä»¶]
    B --> C[EventSourcingManager.save]
    C --> D[EventStore.saveEvents]
    D --> E[EventPublisher.publish]
    E --> F[äº‹ä»¶è®¢é˜…è€…]
    F --> G[æŠ•å½±]
    
    H[é‡æ”¾è¯·æ±‚] --> I[EventStore.getEvents]
    I --> J[AggregateFactory.create]
    J --> K[loadFromHistory]
    K --> L[é‡å»ºçš„èšåˆ]
    
    style A fill:#e1f5ff
    style D fill:#fff4e1
    style E fill:#ffe1f5
    style L fill:#e1ffe1
```

---

## æœ€ä½³å®è·µ

1. **ç®€å•åœºæ™¯ä½¿ç”¨æ³¨è§£**ï¼šæ³¨è§£æä¾›äº†ç®€æ´ã€å£°æ˜å¼çš„æ–¹å¼æ¥å®šä¹‰ä¿¡å·å¤„ç†å™¨ã€‚

2. **é…ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´**ï¼šå§‹ç»ˆè®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´ä»¥é˜²æ­¢æ“ä½œæŒ‚èµ·ã€‚

3. **ç”Ÿäº§ç¯å¢ƒå¯ç”¨æŒ‡æ ‡**ï¼šæŒ‡æ ‡æœ‰åŠ©äºç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶å†µå’Œæ€§èƒ½ã€‚

4. **æ˜æ™ºä½¿ç”¨ä¼˜å…ˆçº§**ï¼šä»…å¯¹å…³é”®æ“ä½œåˆ†é… HIGH ä¼˜å…ˆçº§ã€‚

5. **å®ç°é”™è¯¯å¤„ç†å™¨**ï¼šå§‹ç»ˆä¸ºä¿¡å·å‘å°„æä¾›é”™è¯¯å¤„ç†å™¨ã€‚

6. **ä½¿ç”¨è¿‡æ»¤å™¨è¿›è¡ŒéªŒè¯**ï¼šä½¿ç”¨è¿‡æ»¤å™¨åœ¨å¤„ç†å‰éªŒè¯ä¿¡å·ã€‚

7. **å¯ç”¨ç†”æ–­å™¨**ï¼šä¿æŠ¤ç³»ç»Ÿå…å—çº§è”æ•…éšœã€‚

8. **ç›‘æ§æ­»ä¿¡é˜Ÿåˆ—**ï¼šå®šæœŸæ£€æŸ¥å’Œå¤„ç†æ­»ä¿¡äº‹ä»¶ã€‚

9. **è°¨æ…ä½¿ç”¨äº‹ä»¶æº¯æº**ï¼šäº‹ä»¶æº¯æºå¢åŠ äº†å¤æ‚æ€§ï¼Œä½†æä¾›äº†å®¡è®¡è·Ÿè¸ªå’Œé‡æ”¾èƒ½åŠ›ã€‚

10. **æµ‹è¯•äº‹åŠ¡å¤„ç†**ï¼šç¡®ä¿äº‹åŠ¡è¾¹ç•Œé…ç½®æ­£ç¡®ã€‚

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**é—®é¢˜**ï¼šä¿¡å·æœªè¢«å¤„ç†
- æ£€æŸ¥å¤„ç†å™¨æ˜¯å¦æ­£ç¡®æ³¨å†Œ
- éªŒè¯äº‹ä»¶åç§°æ˜¯å¦å®Œå…¨åŒ¹é…
- æ£€æŸ¥è¿‡æ»¤å™¨æ˜¯å¦é˜»æ­¢äº†ä¿¡å·

**é—®é¢˜**ï¼šå†…å­˜ä½¿ç”¨è¿‡é«˜
- å‡å°‘ SignalMetrics ä¸­çš„ `eventTraces` ä¿ç•™æ—¶é—´
- ä¸ºæŒä¹…åŒ–å¯ç”¨æ•°æ®åº“æ¸…ç†
- æ£€æŸ¥å¤„ç†å™¨ä¸­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼

**é—®é¢˜**ï¼šäº‹åŠ¡å›æ»š
- æ£€æŸ¥äº‹åŠ¡é…ç½®
- éªŒè¯æ•°æ®åº“è¿æ¥
- æŸ¥çœ‹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„å¤±è´¥äº‹ä»¶

---

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

1. Fork ä»“åº“ä» [Hibiscus-Tool/hibiscus-signal](https://github.com/Hibiscus-Tool/hibiscus-signal)
2. åˆ›å»ºæ‚¨çš„åŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'æ·»åŠ ä¸€äº› AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### å¼€å‘æŒ‡å—

- éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼
- ä¸ºæ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•
- æ ¹æ®éœ€è¦æ›´æ–°æ–‡æ¡£
- æäº¤å‰ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ - è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## æ”¯æŒ

- **é—®é¢˜åé¦ˆ**ï¼š[GitHub Issues](https://github.com/Hibiscus-Tool/hibiscus-signal/issues)
- **é‚®ç®±**ï¼š19511899044@163.com
- **GitHub**ï¼š[Hibiscus-Tool](https://github.com/Hibiscus-Tool)
- **ä»“åº“åœ°å€**ï¼š[hibiscus-signal](https://github.com/Hibiscus-Tool/hibiscus-signal)

---

## è‡´è°¢

- Spring Framework å›¢é˜Ÿæä¾›çš„ä¼˜ç§€ Spring Boot é›†æˆ
- Apache Software Foundation æä¾›çš„ Apache License

---

